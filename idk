--// Universal GUI Script vGOATED (Lock-On Camera Version)
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local rootPart = character:WaitForChild("HumanoidRootPart")

--// GUI
local gui = Instance.new("ScreenGui")
gui.Name = "UniversalUI"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 500, 0, 300)
mainFrame.Position = UDim2.new(0.5, -250, 0.5, -150)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
mainFrame.Visible = true
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = gui
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0,12)

-- Tab Buttons Holder
local tabHolder = Instance.new("Frame", mainFrame)
tabHolder.Size = UDim2.new(1,0,0,40)
tabHolder.BackgroundTransparency = 1
local tabLayout = Instance.new("UIListLayout", tabHolder)
tabLayout.FillDirection = Enum.FillDirection.Horizontal
tabLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
tabLayout.Padding = UDim.new(0,8)

-- Content container
local contentFrame = Instance.new("Frame", mainFrame)
contentFrame.Size = UDim2.new(1,-20,1,-60)
contentFrame.Position = UDim2.new(0,10,0,50)
contentFrame.BackgroundTransparency = 1

-- Tab creation
local Tabs = {}
local function createTab(name)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0,100,1,0)
    button.Text = name
    button.Font = Enum.Font.GothamBold
    button.TextSize = 14
    button.TextColor3 = Color3.fromRGB(220,220,220)
    button.BackgroundColor3 = Color3.fromRGB(40,40,40)
    button.Parent = tabHolder
    Instance.new("UICorner", button).CornerRadius = UDim.new(0,8)

    local tabFrame = Instance.new("ScrollingFrame", contentFrame)
    tabFrame.Size = UDim2.new(1,0,1,0)
    tabFrame.Visible = false
    tabFrame.BackgroundTransparency = 1
    tabFrame.CanvasSize = UDim2.new(0,0,0,0)

    local layout = Instance.new("UIListLayout", tabFrame)
    layout.Padding = UDim.new(0,6)
    layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    layout.SortOrder = Enum.SortOrder.LayoutOrder

    button.MouseButton1Click:Connect(function()
        for _,t in pairs(Tabs) do
            t.Frame.Visible = false
            t.Button.BackgroundColor3 = Color3.fromRGB(40,40,40)
        end
        tabFrame.Visible = true
        button.BackgroundColor3 = Color3.fromRGB(70,70,70)
    end)

    local tabData = {Button = button, Frame = tabFrame}
    table.insert(Tabs, tabData)
    if #Tabs == 1 then
        tabFrame.Visible = true
        button.BackgroundColor3 = Color3.fromRGB(70,70,70)
    end
    return tabFrame
end

--// Tabs
local mainTab = createTab("Main")
local playerTab = createTab("Player")
local visualTab = createTab("Visuals")
local settingsTab = createTab("Settings")

--// Button utility
local function createButton(tab,text,callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0.9,0,0,30)
    btn.Text = text
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 14
    btn.TextColor3 = Color3.new(1,1,1)
    btn.BackgroundColor3 = Color3.fromRGB(50,50,50)
    btn.Parent = tab
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0,6)
    btn.MouseEnter:Connect(function() btn.BackgroundColor3 = Color3.fromRGB(70,70,70) end)
    btn.MouseLeave:Connect(function() btn.BackgroundColor3 = Color3.fromRGB(50,50,50) end)
    btn.MouseButton1Click:Connect(callback)
end

--// MAIN TAB
createButton(mainTab,"Rejoin",function()
    game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, game.JobId, player)
end)

createButton(mainTab,"Server Hop",function()
    local HttpService = game:GetService("HttpService")
    local TeleportService = game:GetService("TeleportService")
    local servers = HttpService:JSONDecode(game:HttpGetAsync("https://games.roblox.com/v1/games/"..game.PlaceId.."/servers/Public?sortOrder=Asc&limit=100"))
    for _,s in pairs(servers.data) do
        if s.playing < s.maxPlayers then
            TeleportService:TeleportToPlaceInstance(game.PlaceId, s.id)
            break
        end
    end
end)

--// PLAYER TAB
local noclip = false
createButton(playerTab,"Toggle Noclip",function() noclip = not noclip end)
RunService.Stepped:Connect(function()
    if noclip then
        for _,v in pairs(character:GetDescendants()) do
            if v:IsA("BasePart") and v.CanCollide then v.CanCollide = false end
        end
    end
end)

-- WalkSpeed & JumpPower
createButton(playerTab,"WalkSpeed +",function() humanoid.WalkSpeed+=5 end)
createButton(playerTab,"JumpPower +",function() humanoid.JumpPower+=10 end)

--// LOCK-ON CAMERA
local lockOn = false
local lockTarget = nil
local lockKey = Enum.KeyCode.L -- toggle key

local function getClosestPlayer()
	local closest = nil
	local shortestDist = math.huge
	for _,plr in pairs(Players:GetPlayers()) do
		if plr~=player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
			local dist = (plr.Character.HumanoidRootPart.Position - rootPart.Position).Magnitude
			if dist < shortestDist then
				shortestDist = dist
				closest = plr
			end
		end
	end
	return closest
end

local function toggleLockOn()
	lockOn = not lockOn
	if lockOn then
		lockTarget = getClosestPlayer()
	else
		lockTarget = nil
	end
end

UserInputService.InputBegan:Connect(function(input,gp)
	if not gp and input.KeyCode == lockKey then toggleLockOn() end
end)

createButton(playerTab,"Toggle Lock-On Camera (L)",toggleLockOn)

RunService.RenderStepped:Connect(function()
	if lockOn and lockTarget and lockTarget.Character and lockTarget.Character:FindFirstChild("HumanoidRootPart") then
		local cam = workspace.CurrentCamera
		local targetPos = lockTarget.Character.HumanoidRootPart.Position + Vector3.new(0,2,0)
		local camPos = cam.CFrame.Position
		local direction = (targetPos - camPos).Unit
		cam.CFrame = CFrame.new(camPos, camPos + direction)
	else
		lockTarget = nil
	end
end)

--// VISUALS TAB (ESP with rainbow + hover glow)
local espEnabled=false
createButton(visualTab,"Toggle ESP",function()
	espEnabled=not espEnabled
	for _,plr in pairs(Players:GetPlayers()) do
		if plr~=player and plr.Character and plr.Character:FindFirstChild("Head") then
			if espEnabled then
				local highlight=Instance.new("Highlight",plr.Character)
				highlight.Name="ESP_Highlight"
				highlight.FillTransparency=0.7
				highlight.OutlineTransparency=0
				highlight.FillColor=Color3.fromRGB(255,0,0)
				local billboard=Instance.new("BillboardGui",plr.Character.Head)
				billboard.Name="ESP_Tag"
				billboard.Size=UDim2.new(0,100,0,20)
				billboard.StudsOffset=Vector3.new(0,2,0)
				billboard.AlwaysOnTop=true
				local label=Instance.new("TextLabel",billboard)
				label.Size=UDim2.new(1,0,1,0)
				label.Text=plr.Name
				label.TextColor3=Color3.new(1,1,1)
				label.Font=Enum.Font.GothamBold
				label.TextSize=12
				label.BackgroundTransparency=1
			else
				if plr.Character:FindFirstChild("ESP_Highlight") then plr.Character.ESP_Highlight:Destroy() end
				if plr.Character.Head:FindFirstChild("ESP_Tag") then plr.Character.Head.ESP_Tag:Destroy() end
			end
		end
	end
end)

-- Rainbow ESP
RunService.RenderStepped:Connect(function()
	if espEnabled then
		for _,plr in pairs(Players:GetPlayers()) do
			if plr~=player and plr.Character then
				local h = plr.Character:FindFirstChild("ESP_Highlight")
				if h then
					h.FillColor = Color3.fromHSV(tick()%5/5,1,1)
				end
			end
		end
	end
end)

--// SETTINGS TAB
createButton(settingsTab,"Toggle Rainbow BG",function()
	RunService.RenderStepped:Connect(function()
		mainFrame.BackgroundColor3 = Color3.fromHSV(tick()%10/10,1,1)
	end)
end)

createButton(settingsTab,"Toggle Transparent BG",function()
	mainFrame.BackgroundTransparency = mainFrame.BackgroundTransparency==0 and 0.8 or 0
end)

createButton(settingsTab,"Randomize Buttons Color",function()
	for _,tab in pairs(Tabs) do
		tab.Button.BackgroundColor3=Color3.fromRGB(math.random(0,255),math.random(0,255),math.random(0,255))
	end
end)

--// OPEN/CLOSE BUTTON
local toggleBtn = Instance.new("TextButton", gui)
toggleBtn.Size=UDim2.new(0,40,0,40)
toggleBtn.Position=UDim2.new(0,10,0.5,-20)
toggleBtn.Text="â˜°"
toggleBtn.Font=Enum.Font.GothamBold
toggleBtn.TextSize=20
toggleBtn.TextColor3=Color3.new(1,1,1)
toggleBtn.BackgroundColor3=Color3.fromRGB(30,30,30)
Instance.new("UICorner", toggleBtn).CornerRadius=UDim.new(0,8)

local open = true
toggleBtn.MouseButton1Click:Connect(function()
	open = not open
	mainFrame.Visible = open
end)
