--// Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

--// Player Setup
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local rootPart = character:WaitForChild("HumanoidRootPart")
local camera = workspace.CurrentCamera

--// ScreenGui
local gui = Instance.new("ScreenGui")
gui.Name = "CustomGUI"
gui.Parent = player:WaitForChild("PlayerGui")

--// Tabs
local tabFrame = Instance.new("Frame")
tabFrame.Size = UDim2.new(0, 500, 0, 300)
tabFrame.Position = UDim2.new(0.25, 0, 0.25, 0)
tabFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
tabFrame.Parent = gui

local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0, 12)
uiCorner.Parent = tabFrame

local tabButtons = Instance.new("Frame")
tabButtons.Size = UDim2.new(1, 0, 0, 40)
tabButtons.BackgroundTransparency = 1
tabButtons.Parent = tabFrame

local contentFrame = Instance.new("Frame")
contentFrame.Size = UDim2.new(1, -10, 1, -50)
contentFrame.Position = UDim2.new(0, 5, 0, 45)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = tabFrame

--// UI Layout
local buttonLayout = Instance.new("UIListLayout")
buttonLayout.FillDirection = Enum.FillDirection.Horizontal
buttonLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
buttonLayout.Parent = tabButtons

--// Tab Storage
local tabs = {}
local currentTab = nil

local function createTab(name)
	local btn = Instance.new("TextButton")
	btn.Text = name
	btn.Size = UDim2.new(0, 100, 1, 0)
	btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
	btn.TextColor3 = Color3.new(1,1,1)
	btn.Parent = tabButtons
	
	local hoverGlow = Instance.new("UIStroke")
	hoverGlow.Thickness = 2
	hoverGlow.Color = Color3.fromRGB(0,255,0)
	hoverGlow.Transparency = 1
	hoverGlow.Parent = btn
	
	btn.MouseEnter:Connect(function()
		hoverGlow.Transparency = 0
	end)
	btn.MouseLeave:Connect(function()
		hoverGlow.Transparency = 1
	end)

	local frame = Instance.new("Frame")
	frame.Size = UDim2.new(1,0,1,0)
	frame.Visible = false
	frame.BackgroundTransparency = 1
	frame.Parent = contentFrame
	
	btn.MouseButton1Click:Connect(function()
		if currentTab then currentTab.Visible = false end
		frame.Visible = true
		currentTab = frame
	end)
	
	tabs[name] = frame
	return frame
end

--// Utility for creating buttons
local function createButton(tab, text, callback)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0, 200, 0, 40)
	btn.BackgroundColor3 = Color3.fromRGB(60,60,60)
	btn.TextColor3 = Color3.new(1,1,1)
	btn.Text = text
	btn.Parent = tab
	
	local hoverGlow = Instance.new("UIStroke")
	hoverGlow.Thickness = 2
	hoverGlow.Color = Color3.fromRGB(255,255,255)
	hoverGlow.Transparency = 1
	hoverGlow.Parent = btn
	
	btn.MouseEnter:Connect(function()
		hoverGlow.Transparency = 0
	end)
	btn.MouseLeave:Connect(function()
		hoverGlow.Transparency = 1
	end)
	
	btn.MouseButton1Click:Connect(function()
		callback()
		btn.BackgroundColor3 = Color3.fromRGB(math.random(50,255), math.random(50,255), math.random(50,255))
	end)
end

--// Tabs
local playerTab = createTab("Player")
local settingsTab = createTab("Settings")

--============================================================--
-- Lock-On Feature
local lockOn = false
local lockTarget = nil
local targetHighlight = nil

local function getClosestPlayer()
	local closest = nil
	local shortestDist = math.huge
	for _,plr in pairs(Players:GetPlayers()) do
		if plr~=player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
			local dist = (plr.Character.HumanoidRootPart.Position - rootPart.Position).Magnitude
			if dist < shortestDist then
				shortestDist = dist
				closest = plr
			end
		end
	end
	return closest
end

local function toggleLockOn()
	lockOn = not lockOn
	if not lockOn then
		camera.CameraSubject = humanoid
		if targetHighlight then targetHighlight:Destroy() targetHighlight=nil end
	end
end

createButton(playerTab,"Toggle Lock-On (L)",toggleLockOn)
UserInputService.InputBegan:Connect(function(input,gp)
	if not gp and input.KeyCode == Enum.KeyCode.L then
		toggleLockOn()
	end
end)

RunService.RenderStepped:Connect(function()
	if lockOn then
		local closest = getClosestPlayer()
		if closest and closest.Character and closest.Character:FindFirstChild("HumanoidRootPart") then
			lockTarget = closest
			camera.CameraSubject = humanoid -- stays following YOU
			local targetPos = closest.Character.HumanoidRootPart.Position + Vector3.new(0,2,0)
			local camPos = camera.CFrame.Position
			camera.CFrame = CFrame.new(camPos, targetPos)
			
			-- highlight
			if not targetHighlight then
				targetHighlight = Instance.new("Highlight")
				targetHighlight.FillTransparency = 0.5
				targetHighlight.OutlineColor = Color3.fromRGB(0,255,0)
				targetHighlight.FillColor = Color3.fromRGB(0,100,0)
				targetHighlight.Parent = closest.Character
			else
				targetHighlight.Adornee = closest.Character
			end
		end
	end
end)

--============================================================--
-- Settings Features
local rainbow = false
local bgInvisible = false

createButton(settingsTab,"Toggle Rainbow BG",function()
	rainbow = not rainbow
	bgInvisible = false
end)

createButton(settingsTab,"Make BG Invisible",function()
	bgInvisible = not bgInvisible
	if bgInvisible then
		tabFrame.BackgroundTransparency = 1
	else
		tabFrame.BackgroundTransparency = 0
	end
end)

RunService.RenderStepped:Connect(function()
	if rainbow and not bgInvisible then
		local t = tick()
		tabFrame.BackgroundColor3 = Color3.fromHSV((t % 5) / 5, 1, 1)
	end
end)

-- Default open Player tab
currentTab = playerTab
playerTab.Visible = true
