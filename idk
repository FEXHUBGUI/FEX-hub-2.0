local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

-- GUI Setup
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
screenGui.Name = "SpeedGUI"
screenGui.ResetOnSpawn = false

-- Main Frame
local frame = Instance.new("Frame", screenGui)
frame.Size = UDim2.new(0, 250, 0, 240)
frame.Position = UDim2.new(0.5, -125, 0.5, -120)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.Active = true
frame.Draggable = true
frame.Visible = true

-- Background Image
local background = Instance.new("ImageLabel", frame)
background.Size = UDim2.new(1, 0, 1, 0)
background.Position = UDim2.new(0, 0, 0, 0)
background.Image = "rbxassetid://113208146688561"
background.BackgroundTransparency = 1
background.ImageTransparency = 0.3
background.ZIndex = 0

-- Title Bar
local title = Instance.new("TextLabel", frame)
title.Name = "TitleContainer"
title.Size = UDim2.new(1, 0, 0, 30)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
title.Text = ""
title.TextTransparency = 1
title.ZIndex = 1

-- Animated Title Text
local animatedText = Instance.new("TextLabel", title)
animatedText.Name = "AnimatedText"
animatedText.Text = "CoreX Hub V1"
animatedText.Size = UDim2.new(0, 200, 1, 0)
animatedText.AnchorPoint = Vector2.new(0.5, 0.5)
animatedText.Position = UDim2.new(0.5, 0, 0.5, 0)
animatedText.BackgroundTransparency = 1
animatedText.TextColor3 = Color3.new(1, 1, 1)
animatedText.Font = Enum.Font.SourceSansBold
animatedText.TextSize = 20
animatedText.TextStrokeTransparency = 0
animatedText.ZIndex = 2

-- Speed Button
local slider = Instance.new("TextButton", frame)
slider.Size = UDim2.new(0, 200, 0, 30)
slider.Position = UDim2.new(0, 25, 0, 45)
slider.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
slider.TextColor3 = Color3.new(1, 1, 1)
slider.Font = Enum.Font.SourceSans
slider.TextSize = 18
slider.Text = "Speed: 16"
slider.ZIndex = 2

-- ESP Button
local espToggle = Instance.new("TextButton", frame)
espToggle.Size = UDim2.new(0, 200, 0, 30)
espToggle.Position = UDim2.new(0, 25, 0, 85)
espToggle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
espToggle.TextColor3 = Color3.new(1, 1, 1)
espToggle.Font = Enum.Font.SourceSans
espToggle.TextSize = 18
espToggle.Text = "ESP: OFF"
espToggle.ZIndex = 2

-- God Mode Button
local godToggle = Instance.new("TextButton", frame)
godToggle.Size = UDim2.new(0, 200, 0, 30)
godToggle.Position = UDim2.new(0, 25, 0, 125)
godToggle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
godToggle.TextColor3 = Color3.new(1, 1, 1)
godToggle.Font = Enum.Font.SourceSans
godToggle.TextSize = 18
godToggle.Text = "God Mode: OFF"
godToggle.ZIndex = 2

-- Float Button
local floatToggle = Instance.new("TextButton", frame)
floatToggle.Size = UDim2.new(0, 200, 0, 30)
floatToggle.Position = UDim2.new(0, 25, 0, 165)
floatToggle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
floatToggle.TextColor3 = Color3.new(1, 1, 1)
floatToggle.Font = Enum.Font.SourceSans
floatToggle.TextSize = 18
floatToggle.Text = "Float: OFF"
floatToggle.ZIndex = 2

-- Toggle GUI Button
local toggleButton = Instance.new("TextButton", screenGui)
toggleButton.Size = UDim2.new(0, 120, 0, 30)
toggleButton.Position = UDim2.new(0, 10, 0, 10)
toggleButton.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
toggleButton.TextColor3 = Color3.new(1, 1, 1)
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextSize = 18
toggleButton.Text = "Toggle CoreX"

-- RGB animation for Toggle Button
task.spawn(function()
	while true do
		local hue = (tick() % 5) / 5
		local color = Color3.fromHSV(hue, 1, 1)
		toggleButton.BackgroundColor3 = color
		task.wait(0.03)
	end
end)

toggleButton.MouseButton1Click:Connect(function()
	frame.Visible = not frame.Visible
end)

-- Speed logic
local speeds = {16, 32, 50, 100}
local index = 1
slider.MouseButton1Click:Connect(function()
	index += 1
	if index > #speeds then index = 1 end
	local speed = speeds[index]
	slider.Text = "Speed: " .. speed
	humanoid.WalkSpeed = speed
end)

-- ESP logic
local espEnabled = false
local highlights = {}
local function createESP(targetPlayer)
	if targetPlayer == player then return end
	if highlights[targetPlayer] then return end
	local char = targetPlayer.Character
	if not char then return end
	local highlight = Instance.new("Highlight")
	highlight.Name = "ESPHighlight"
	highlight.Adornee = char
	highlight.FillColor = Color3.fromRGB(255, 0, 0)
	highlight.FillTransparency = 0.5
	highlight.OutlineColor = Color3.new(1, 1, 1)
	highlight.OutlineTransparency = 0
	highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
	highlight.Parent = char
	highlights[targetPlayer] = highlight
end

local function removeESP(targetPlayer)
	if highlights[targetPlayer] then
		highlights[targetPlayer]:Destroy()
		highlights[targetPlayer] = nil
	end
end

local function updateESP()
	for _, plr in pairs(game.Players:GetPlayers()) do
		if espEnabled then
			createESP(plr)
		else
			removeESP(plr)
		end
	end
end

game.Players.PlayerAdded:Connect(function(p)
	p.CharacterAdded:Connect(function()
		if espEnabled then
			wait(1)
			createESP(p)
		end
	end)
end)

game.Players.PlayerRemoving:Connect(function(p)
	removeESP(p)
end)

espToggle.MouseButton1Click:Connect(function()
	espEnabled = not espEnabled
	espToggle.Text = "ESP: " .. (espEnabled and "ON" or "OFF")
	updateESP()
end)

-- God Mode logic
local godMode = false
task.spawn(function()
	while true do
		if godMode then
			pcall(function()
				if humanoid and humanoid.Health < humanoid.MaxHealth then
					humanoid.Health = humanoid.MaxHealth
				end
			end)
		end
		task.wait(0.1)
	end
end)

godToggle.MouseButton1Click:Connect(function()
	godMode = not godMode
	godToggle.Text = "God Mode: " .. (godMode and "ON" or "OFF")
end)

-- === Float logic with virtual joystick ===
local flying = false
local floatSpeed = 50
local bodyGyro, bodyVel

-- Joystick UI
local joystickBase = Instance.new("ImageLabel", screenGui)
joystickBase.Size = UDim2.new(0, 120, 0, 120)
joystickBase.Position = UDim2.new(0, 30, 1, -150)
joystickBase.Image = "rbxassetid://11483214659"
joystickBase.BackgroundTransparency = 1
joystickBase.Visible = false
joystickBase.ZIndex = 10

local joystickStick = Instance.new("ImageButton", joystickBase)
joystickStick.Size = UDim2.new(0, 60, 0, 60)
joystickStick.Position = UDim2.new(0.5, -30, 0.5, -30)
joystickStick.Image = "rbxassetid://11483214659"
joystickStick.BackgroundTransparency = 1
joystickStick.AutoButtonColor = false
joystickStick.ZIndex = 11

-- Fly physics
local moveVector = Vector3.zero
local dragging = false

joystickStick.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
	end
end)

joystickStick.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.Touch then
		dragging = false
		moveVector = Vector3.zero
		joystickStick.Position = UDim2.new(0.5, -30, 0.5, -30)
	end
end)

joystickStick.InputChanged:Connect(function(input)
	if dragging and input.Position then
		local delta = Vector2.new(input.Position.X, input.Position.Y) - joystickBase.AbsolutePosition
		local radius = 50
		local clamped = delta.Unit * math.min(delta.Magnitude, radius)
		moveVector = Vector3.new(clamped.X, 0, clamped.Y).Unit

		joystickStick.Position = UDim2.new(0.5, clamped.X - 30, 0.5, clamped.Y - 30)
	end
end)

-- Toggle Float On/Off
floatToggle.MouseButton1Click:Connect(function()
	flying = not flying
	floatToggle.Text = "Float: " .. (flying and "ON" or "OFF")
	joystickBase.Visible = flying

	if flying then
		bodyGyro = Instance.new("BodyGyro", character.PrimaryPart)
		bodyGyro.MaxTorque = Vector3.new(400000, 400000, 400000)
		bodyGyro.P = 100000

		bodyVel = Instance.new("BodyVelocity", character.PrimaryPart)
		bodyVel.MaxForce = Vector3.new(400000, 400000, 400000)
		bodyVel.Velocity = Vector3.zero
	else
		if bodyGyro then bodyGyro:Destroy() end
		if bodyVel then bodyVel:Destroy() end
	end
end)

-- Movement handler
game:GetService("RunService").RenderStepped:Connect(function()
	if flying and character and character.PrimaryPart then
		local cam = workspace.CurrentCamera
		bodyGyro.CFrame = cam.CFrame
		bodyVel.Velocity = cam.CFrame:VectorToWorldSpace(moveVector) * floatSpeed
	end
end)

-- Animated Title
task.spawn(function()
	local t = 0
	while true do
		t += 0.05
		local ripple = math.sin(t * 2) * 4
		local hue = (tick() % 3) / 3
		animatedText.Position = UDim2.new(0.5, ripple, 0.5, 0)
		animatedText.TextColor3 = Color3.fromHSV(hue, 1, 1)
		task.wait(0.016)
	end
end)
